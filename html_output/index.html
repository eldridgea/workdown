<html>
<head>
    <title>Workdown Sandbox</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
</head>
<body>
<h1>Badabing Badabom</h1>
<p>This is a test of my workers script</p>
<p>I've gotten used to having <code>freeipa-client</code> available in <code>dnf</code> or <code>apt</code> repos, so I've rarely setup clients manually. However, I did today in <a href="https://www.raspberrypi.org/downloads/raspbian/">Raspbian</a> on my Raspberry Pi. I wanted to document it here mainly for my own memory. It was extremely straightforward but there were a couple tweaks needed. (In this doc "example.com" replaces my domain).</p>
<p>On the Pi install sssd, libnss-sss, libpam-sss, openssh-server krb5-user, and krb5-config.</p>
<p>On the FreeIPA server:</p>
<p>```
$ kinit admin</p>
<p>$ ipa host-add --ip-address=192.168.0.3 pi.example.com</p>
<p>$ ipa host-add-managedby --hosts=freeipa.example.com pi.example.com</p>
<p>$ ipa-getkeytab -s freeipa.example.com -p host/pi.example.com -k /tmp/pi.keytab</p>
<p>$ scp /tmp/pi.keytab pi:/etc/krb5.keytab
```</p>
<p>This mostly took care of it but the SSSD conf file needed to be configured. I had an old config from another server that needed to be "upgraded" using <a href="https://github.com/npmccallum/sssd/blob/master/src/config/SSSDConfig/sssd_upgrade_config.py">this script</a> leaving me with this in /etc/sssd/sssd.conf:</p>
<p>```
[sssd]
config_file_version = 2</p>
<p>[domain/example.com]</p>
<p>cache_credentials = True
krb5_store_password_if_offline = True
ipa_domain = example.com
id_provider = ipa
auth_provider = ipa
access_provider = ipa
ipa_hostname = pi.example.com
chpass_provider = ipa
ipa_server = <em>srv</em>, freeipa.example.com
ldap_tls_cacert = /etc/ipa/ca.crt
[sssd]
services = nss, sudo, pam, ssh</p>
<p>domains = example.com
[nss]
homedir_substring = /home</p>
<p>[pam]</p>
<p>[sudo]</p>
<p>[autofs]</p>
<p>[ssh]</p>
<p>[pac]
```</p>
<p>Then, in FreeIPA's web interface, I went to Authentication &gt; Certificates and open up <code>CN=Certificate Authority,O=EXAMPLE.COM</code> (serial number 1 in my case), copied the certificate value, and pasted it into /etc/ipa/ca.crt on my Pi.</p>
<p>I then opened /etc/ssh/sshd_config and changed <code>GSSAPIAuthentication</code> to "yes". Once I restarted SSSD and SSH, everything worked like a charm</p></body>
</html>